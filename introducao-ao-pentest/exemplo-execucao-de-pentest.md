## Escopo do Pentest (Relembrando)

O pentest é realizado para a empresa "Grand Business" e possui o seguinte escopo:

* **URL:** `www.grandbusiness.com.br`
* **Tipo de Teste:** Pentest Black Box Externo (abordagem ampla).
* **Limites de horário:** Não existem limites de horário para os testes.
* **Ataques Proibidos:** Ataques de Stress (DDoS) e Ataques de Engenharia Social não são permitidos.

## Fases de um Pentest (Metodologia PTES)

O processo técnico de um pentest é dividido nas seguintes fases, abordadas neste vídeo a partir da Fase 02:

* **Fase 1:** Preparação - Preparar para ação (alinhamento com o cliente) - *Abordado no vídeo anterior.*
* **Fase 2:** Coleta de Informações
* **Fase 3:** Varredura e Enumeração
* **Fase 4:** Análise de Vulnerabilidades
* **Fase 5:** Exploração
* **Fase 6:** Pós-Exploração
* **Fase 7:** Escrita de Relatórios

---

### Fase 02 - Coleta de Informações

Nesta fase, o objetivo é reunir o máximo de informações sobre o alvo a partir de fontes públicas, sem interação direta.

* **Técnicas Utilizadas:**
    * **Ferramenta própria:** Uso de uma ferramenta desenvolvida pelo apresentador para identificar entradas DNS, servidores e IPs.
    * **Google Hacking:** Utilização de operadores de busca do Google para encontrar informações específicas.
    * **Comando `host`:** Para realizar consultas DNS e tentar transferências de zona.
    * **Análise de Subdomínios:** Identificação de subdomínios, como `rh.grandbusiness.com.br`, `firewall.grandbusiness.com.br`, `intranet.grandbusiness.com.br`, `ftp.grandbusiness.com.br`, `mail.grandbusiness.com.br`, `ns1.grandbusiness.com.br`, `ns2.grandbusiness.com.br`.
    * **Endereços IP:** Descoberta de múltiplos endereços IP associados ao domínio.

* **Resultado:** Foram encontrados diversos subdomínios e endereços IP, que servirão como base para as próximas fases.

---

### Fase 03 - Varredura e Enumeração

Com base nas informações coletadas, esta fase visa identificar portas abertas e serviços ativos nos alvos.

* **Ferramentas Utilizadas:**
    * **Nmap:** Ferramenta de mapeamento de rede e varredura de portas. No exemplo, é usado para escanear todas as portas do host `rh.grandbusiness.com.br`.
* **Resultado:** O Nmap revela várias portas abertas e serviços, como FTP (porta 21), SSH (porta 22), HTTP (porta 80 e 8080), HTTPS (porta 443), etc. Isso fornece um mapa inicial da superfície de ataque do alvo.

---

### Fase 04 - Análise de Vulnerabilidades

Nesta fase, os serviços identificados são analisados em busca de vulnerabilidades conhecidas ou padrões de configuração que possam ser explorados.

* **Cenário:** O site `rh.grandbusiness.com.br` (setor de RH/oportunidades de emprego) é acessado.
* **Vulnerabilidade Encontrada:** O site passa parâmetros via GET na URL (e.g., `rh.grandbusiness.com.br/index.php?page=...`). Ao manipular esses parâmetros, foi identificada uma vulnerabilidade de **Local File Inclusion (LFI)**.
    * Ao tentar incluir arquivos inexistentes ou com parâmetros inválidos, o servidor retorna erros que revelam a tentativa de inclusão de arquivos `.php` no final.
    * É possível utilizar a técnica `null byte` (`%00`) para burlar a extensão e ler arquivos arbitrários no servidor.
    * **Exemplo de Exploração:** Foi demonstrado como ler arquivos de log (`/etc/passwd` ou logs do servidor web) usando a vulnerabilidade LFI.
* **Resultado:** A vulnerabilidade LFI foi confirmada, permitindo a leitura de arquivos sensíveis no servidor. Embora não seja imediatamente crítica, ela pode ser um vetor para explorações mais avançadas.

---

### Fase 05 - Exploração

Nesta fase, a vulnerabilidade identificada é utilizada para obter acesso inicial ao sistema alvo.

* **Técnica Utilizada:** Infecção por log.
    * Como o servidor registra todas as requisições no log, é possível enviar uma requisição maliciosa (contendo um payload PHP/webshell) para que o servidor a grave no log.
    * Ao acessar o log com a vulnerabilidade LFI, o código PHP malicioso é executado pelo servidor.
    * É utilizada uma webshell em PHP para executar comandos no servidor.
* **Resultado:** Acesso inicial ao servidor web da Grand Business, permitindo a execução de comandos remotos e o upload de arquivos. É demonstrado a obtenção de uma shell de comando e a listagem de diretórios.

---

### Fase 06 - Pós-Exploração

Após obter o acesso inicial, o objetivo é se aprofundar no ambiente comprometido para atingir metas mais sensíveis (como o servidor interno principal).

* **Pivotagem para a Rede Interna:**
    * O servidor comprometido possui duas interfaces de rede: uma para a internet e outra para a rede interna (privada).
    * É utilizada uma técnica de **pivotagem** para rotear o tráfego da máquina do atacante para a rede interna do cliente, utilizando o servidor comprometido como ponte.
    * **Ferramentas Utilizadas:**
        * **Meterpreter (Metasploit Framework):** Para configurar o roteamento (comando `run autoroute`).
        * **Proxychains:** Para encaminhar o tráfego de ferramentas de rede através do servidor proxy (comando `proxychains nmap`).
    * **Resultado:** O atacante consegue escanear e se comunicar com hosts na rede interna (ex: `172.16.1.0/24`), que não estavam expostos diretamente à internet.

* **Identificação de Serviços Internos:**
    * É identificado um host na rede interna (`172.16.1.60`) e a porta `110/tcp` (POP3 - gBusiness.rede) é encontrada aberta.

* **Obtenção de Credenciais e Hashes:**
    * Dentro do servidor comprometido, são utilizadas ferramentas para extrair credenciais de acesso (usuários e senhas, incluindo hashes).
    * **Exemplo:** A ferramenta `wce64.exe` é usada para despejar senhas em texto claro e hashes. A senha do usuário "Rogério" e do "Administrator" são capturadas.

* **Acesso ao Servidor Principal (Controlador de Domínio):**
    * Com as credenciais válidas e a capacidade de comunicação com a rede interna, o atacante tenta acessar o servidor principal (`172.16.1.60`), que é um Windows Server 2008 R2 (Controlador de Domínio).
    * A porta `3389` (Remote Desktop Protocol - RDP) do servidor principal é redirecionada para a máquina local do atacante (através de `portfwd`).
    * É utilizado um cliente RDP (Remote Desktop) para se conectar ao servidor usando as credenciais do administrador.
    * **Resultado:** O atacante obtém acesso gráfico (área de trabalho) ao servidor principal da Grand Business, confirmando o controle total sobre o ambiente interno.

---

### Fase 07 - Escrita de Relatório

A fase final do pentest envolve a documentação detalhada de todas as descobertas e ações realizadas.

* **Conteúdo do Relatório:**
    * **Informações Coletadas:** IPs, blocos de rede, subdomínios, serviços.
    * **Vulnerabilidades Encontradas:** Descrição de cada vulnerabilidade, incluindo a LFI e o acesso ao servidor web.
    * **Explorações Realizadas:** Detalhes técnicos de como as vulnerabilidades foram exploradas para obter acesso, incluindo a infecção por log e a pivotagem para a rede interna.
    * **Evidências:** Capturas de tela (screenshots) de todas as etapas.
    * **Grau de Risco:** Classificação do impacto de cada vulnerabilidade (por exemplo, "crítico" para o acesso ao servidor principal).
    * **Recomendações:** Sugestões detalhadas para corrigir as vulnerabilidades, como filtragem de entrada para aplicações web e implementação de um Web Application Firewall (WAF).
    * **Formato:** Um documento completo e profissional, geralmente em formato PDF.

---

## Termos e Acordos Importantes

O vídeo também reitera a importância de:

* **NDA (Acordo de Confidencialidade):** Um contrato administrativo que garante que informações obtidas durante o pentest não serão divulgadas. O descumprimento pode acarretar em processos judiciais e multas.
* **Termo de Pagamento:** Define as condições e parcelas para o pagamento do serviço.

---

Este exemplo prático visa fornecer uma visão geral do processo técnico de um pentest, desde a coleta de informações até a obtenção de acesso a alvos críticos e a documentação dos resultados. Para um aprendizado mais aprofundado, o treinamento abordará cada fase e técnica em detalhes.
